# üèóÔ∏è RRHH Backend API - Sistema de Recibos de Sueldo

![FastAPI](https://img.shields.io/badge/FastAPI-005571?style=for-the-badge&logo=fastapi)
![Python](https://img.shields.io/badge/python-3670A0?style=for-the-badge&logo=python&logoColor=ffdd54)
![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?style=for-the-badge&logo=docker&logoColor=white)

## Tabla de Contenidos
- [üèóÔ∏è RRHH Backend API - Sistema de Recibos de Sueldo](#Ô∏è-rrhh-backend-api---sistema-de-recibos-de-sueldo)
  - [Tabla de Contenidos](#tabla-de-contenidos)
  - [üìñ Descripci√≥n](#-descripci√≥n)
  - [üîß Funcionalidades](#-funcionalidades)
  - [üèõÔ∏è Arquitectura del C√≥digo](#Ô∏è-arquitectura-del-c√≥digo)
  - [üìÅ Estructura del Proyecto](#-estructura-del-proyecto)
  - [üöÄ Instalaci√≥n y Configuraci√≥n](#-instalaci√≥n-y-configuraci√≥n)
    - [Prerrequisitos](#prerrequisitos)
    - [Instalaci√≥n Local](#instalaci√≥n-local)
    - [Instalaci√≥n con Docker](#instalaci√≥n-con-docker)
  - [üìã Endpoints de la API](#-endpoints-de-la-api)
    - [GET /](#get-)
    - [GET /hr/recibo/imagen](#get-hrreciboImagen)
  - [üß™ Pruebas de la API](#-pruebas-de-la-api)
  - [üìä Monitoreo y Logs](#-monitoreo-y-logs)
  - [üîí Seguridad](#-seguridad)
  - [üê≥ Dockerizaci√≥n](#-dockerizaci√≥n)
  - [üîß Desarrollo y Mantenimiento](#-desarrollo-y-mantenimiento)

## üìñ Descripci√≥n

El **RRHH Backend API** es un servicio REST construido con FastAPI que proporciona acceso a recibos de sueldo de empleados. Este backend est√° dise√±ado para ser consumido por agentes de IA especializados en recursos humanos, ofreciendo una interfaz simple y eficiente para la obtenci√≥n de documentos de n√≥mina en formato markdown.

Este sistema forma parte del ecosistema de automatizaci√≥n de RRHH y act√∫a como el backend tradicional que expone datos de n√≥minas a trav√©s de APIs REST est√°ndar.

## üîß Funcionalidades

- **‚úÖ Servicio de Estado**: Endpoint de health check para verificar disponibilidad
- **üßæ Obtenci√≥n de Recibos**: Recuperaci√≥n de im√°genes de recibos de sueldo por nombre de empleado
- **üìù Formato Markdown**: Conversi√≥n autom√°tica de im√°genes en formato markdown para f√°cil visualizaci√≥n
- **üåê CORS Habilitado**: Soporte completo para Cross-Origin Resource Sharing
- **üìä Auto-documentaci√≥n**: Documentaci√≥n autom√°tica con Swagger UI y ReDoc
- **üîÑ Respuestas JSON**: Formato estructurado y consistente de respuestas

## üèõÔ∏è Arquitectura del C√≥digo

### Componentes Principales

```python
# Importaciones principales
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
import uvicorn
```

### FastAPI Application

```python
app = FastAPI(title="RRHH Backend API", description="API para recursos humanos")
```

La aplicaci√≥n utiliza FastAPI como framework principal, configurado con:
- **t√≠tulo descriptivo** para la documentaci√≥n autom√°tica
- **descripci√≥n clara** del prop√≥sito del servicio

### Configuraci√≥n CORS

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**Configuraci√≥n permisiva** que permite:
- Todos los or√≠genes (`allow_origins=["*"]`)
- Credenciales en requests cross-origin
- Todos los m√©todos HTTP
- Todos los headers personalizados

> ‚ö†Ô∏è **Nota de Seguridad**: En producci√≥n, se recomienda restringir los or√≠genes permitidos

### Endpoint de Health Check

```python
@app.get("/")
async def root():
    return {"message": "RRHH Backend API est√° funcionando"}
```

### Endpoint Principal de Recibos

```python
@app.get("/hr/recibo/imagen")
async def imagen_markdown(nombre_empleado: str):
    # URL de imagen dummy para demostraci√≥n
    URL_IMAGEN = "https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.rafap.com.uy%2Fmvdcms%2Fimgnoticias%2F202109%2F9691.png&f=1&nofb=1&ipt=5ad647da537e4656bbad02f4fc95c261e1fd96611bc77c3984344fa7bb304fbc"
    markdown_str = f"![Imagen recibo de sueldo de {nombre_empleado}]({URL_IMAGEN})"
    
    return {"markdown": markdown_str}
```

**Funcionamiento**:
1. Recibe el `nombre_empleado` como par√°metro de query
2. Genera un string markdown con la imagen del recibo
3. Retorna un objeto JSON con el markdown generado

> üìù **Nota**: Actualmente utiliza una imagen dummy. En producci√≥n deber√≠a conectarse a un sistema real de n√≥minas.

## üìÅ Estructura del Proyecto

```
rrhh_backend_api/
‚îú‚îÄ‚îÄ app.py              # Aplicaci√≥n principal FastAPI
‚îú‚îÄ‚îÄ Dockerfile          # Configuraci√≥n de contenedor Docker
‚îú‚îÄ‚îÄ requirements.txt    # Dependencias Python
‚îî‚îÄ‚îÄ README.md          # Documentaci√≥n (este archivo)
```

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- **Python 3.12+**
- **pip** (gestor de paquetes Python)
- **Docker** (opcional, para contenedorizaci√≥n)

### Instalaci√≥n Local

1. **Navegar al directorio del proyecto**:
```bash
cd usecase-setup/lab-1-agente-rrhh/rrhh_backend_api
```

2. **Crear entorno virtual** (recomendado):
```bash
python -m venv venv
source venv/bin/activate  # En Windows: venv\Scripts\activate
```

3. **Instalar dependencias**:
```bash
pip install -r requirements.txt
```

4. **Ejecutar la aplicaci√≥n**:
```bash
python app.py
```

5. **Verificar funcionamiento**:
   - API disponible en: `http://localhost:8080`
   - Documentaci√≥n Swagger: `http://localhost:8080/docs`
   - Documentaci√≥n ReDoc: `http://localhost:8080/redoc`

### Instalaci√≥n con Docker

1. **Construir la imagen Docker**:
```bash
docker build -t rrhh-backend-api .
```

2. **Ejecutar el contenedor**:
```bash
docker run -d -p 8080:8080 --name rrhh-api rrhh-backend-api
```

3. **Verificar logs del contenedor**:
```bash
docker logs rrhh-api
```

## üìã Endpoints de la API

### GET /

**Descripci√≥n**: Health check del servicio

**Par√°metros**: Ninguno

**Respuesta**:
```json
{
  "message": "RRHH Backend API est√° funcionando"
}
```

**C√≥digo de estado**: `200 OK`

### GET /hr/recibo/imagen

**Descripci√≥n**: Obtiene la imagen del recibo de sueldo de un empleado en formato markdown

**Par√°metros de Query**:
- `nombre_empleado` (string, requerido): Nombre completo del empleado

**Ejemplo de Request**:
```bash
curl "http://localhost:8080/hr/recibo/imagen?nombre_empleado=Juan%20P√©rez"
```

**Respuesta exitosa**:
```json
{
  "markdown": "![Imagen recibo de sueldo de Juan P√©rez](https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.rafap.com.uy%2Fmvdcms%2Fimgnoticias%2F202109%2F9691.png&f=1&nofb=1&ipt=5ad647da537e4656bbad02f4fc95c261e1fd96611bc77c3984344fa7bb304fbc)"
}
```

**C√≥digo de estado**: `200 OK`

## üß™ Pruebas de la API

### Usando curl

```bash
# Health check
curl http://localhost:8080/

# Obtener recibo de sueldo
curl "http://localhost:8080/hr/recibo/imagen?nombre_empleado=Mar√≠a%20Garc√≠a"
```

### Usando Python requests

```python
import requests

# Health check
response = requests.get("http://localhost:8080/")
print(response.json())

# Obtener recibo
response = requests.get(
    "http://localhost:8080/hr/recibo/imagen",
    params={"nombre_empleado": "Mar√≠a Garc√≠a"}
)
print(response.json())
```

### Usando Swagger UI

1. Abrir `http://localhost:8080/docs`
2. Expandir el endpoint deseado
3. Hacer clic en "Try it out"
4. Introducir par√°metros
5. Ejecutar la prueba

## üìä Monitoreo y Logs

### Logs de la Aplicaci√≥n

La aplicaci√≥n utiliza el sistema de logging por defecto de uvicorn:

```bash
INFO:     Started server process [12345]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
```

### M√©tricas Disponibles

- **Health Status**: Verificable en el endpoint `/`
- **Request Logs**: Uvicorn registra autom√°ticamente todas las requests
- **Response Times**: Incluidos en los logs de uvicorn

## üîí Seguridad

### Configuraci√≥n Actual

- **CORS**: Configurado de manera permisiva (todos los or√≠genes)
- **HTTPS**: No configurado (solo HTTP en puerto 8080)
- **Autenticaci√≥n**: No implementada
- **Rate Limiting**: No implementado

### Recomendaciones para Producci√≥n

1. **Restringir CORS**:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["https://tudominio.com"],  # Solo dominios espec√≠ficos
    allow_credentials=True,
    allow_methods=["GET"],  # Solo m√©todos necesarios
    allow_headers=["*"],
)
```

2. **Implementar HTTPS**:
```python
if __name__ == "__main__":
    uvicorn.run(
        app, 
        host="0.0.0.0", 
        port=8080,
        ssl_keyfile="path/to/key.pem",
        ssl_certfile="path/to/cert.pem"
    )
```

3. **Agregar autenticaci√≥n**:
```python
from fastapi import Depends, HTTPException
from fastapi.security import HTTPBearer

security = HTTPBearer()

@app.get("/hr/recibo/imagen")
async def imagen_markdown(
    nombre_empleado: str,
    token: str = Depends(security)
):
    # Validar token
    if not validate_token(token):
        raise HTTPException(status_code=401, detail="Token inv√°lido")
    # ... resto del c√≥digo
```

## üê≥ Dockerizaci√≥n

### Dockerfile Explicado

```dockerfile
FROM python:3.12-slim          # Base image ligera con Python 3.12
WORKDIR /app                   # Directorio de trabajo en el contenedor
COPY requirements.txt .        # Copia archivo de dependencias
RUN pip install --no-cache-dir -r requirements.txt  # Instala dependencias
COPY . .                       # Copia c√≥digo fuente
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8080"]  # Comando de inicio
```

### Comandos Docker √ötiles

```bash
# Construir imagen
docker build -t rrhh-backend-api .

# Ejecutar contenedor
docker run -p 8080:8080 rrhh-backend-api

# Ejecutar en background
docker run -d -p 8080:8080 --name rrhh-api rrhh-backend-api

# Ver logs
docker logs rrhh-api

# Parar contenedor
docker stop rrhh-api

# Eliminar contenedor
docker rm rrhh-api
```

## üîß Desarrollo y Mantenimiento

### Agregar Nuevos Endpoints

1. **Definir funci√≥n async**:
```python
@app.get("/nuevo-endpoint")
async def nuevo_endpoint(parametro: str):
    # L√≥gica del endpoint
    return {"resultado": "datos"}
```

2. **Agregar validaci√≥n**:
```python
from pydantic import BaseModel

class RequestModel(BaseModel):
    campo: str
    valor: int

@app.post("/endpoint-validado")
async def endpoint_validado(data: RequestModel):
    return {"procesado": data.campo}
```

### Conectar con Sistema Real

Para conectar con un sistema real de n√≥minas, reemplazar la l√≥gica dummy:

```python
import httpx  # Cliente HTTP async

@app.get("/hr/recibo/imagen")
async def imagen_markdown(nombre_empleado: str):
    # Conectar con sistema real
    async with httpx.AsyncClient() as client:
        response = await client.get(
            f"https://sistema-nominas.com/api/recibo/{nombre_empleado}"
        )
        imagen_url = response.json()["imagen_url"]
    
    markdown_str = f"![Imagen recibo de sueldo de {nombre_empleado}]({imagen_url})"
    return {"markdown": markdown_str}
```

### Dependencias

Las dependencias est√°n definidas en `requirements.txt`:

```
fastapi          # Framework web moderno y r√°pido
uvicorn          # Servidor ASGI para FastAPI  
python-multipart # Soporte para form data y file uploads
```

---

> üìö **Documentaci√≥n relacionada**: 
> - [FastAPI Documentation](https://fastapi.tiangolo.com/)
> - [Uvicorn Documentation](https://www.uvicorn.org/)
> - [Docker Documentation](https://docs.docker.com/)
